# Funktion die das date_model erstellt
# date_model: Uhrzeit der Messung wird außer Acht 
# gelassen (es zählen nur die Tage)

date_model_function <- function(
  date_data # Datensatz ohne Uhrzeit
) {

## Modell

date_model <- gam(
  cbind(lvs_true, lvs_false) ~ s(int_date, bs = "ps", k = 14) + 
    s(avalanche_report, bs = "ps", k = 5) +
    s(int_day, bs = "cp", k = 7) +
    s(temperature, bs = "ps", k = 10) +
    s(solar_radiation_prop, bs = "ps", k = 10) +
    s(snow_diff, bs = "ps", k = 10) +
    holiday,
  knots = list(
    # int_date
    c(17875, 17882.5, 17890, 17897.5, 17914, 17921.5, 17929, 17936.5, 17944, 17951.5, 17959, 17966.5, 17974, 17981.5, 17989, 17996.5, 18004, 18011.5),
    c(), # avalanche report
    c(), # int_day
    # temperature
    c(-14.7, -11.3, -7.9, -4.5, -2.8, -1.4, 0.2, 1.7, 2.3, 3.6, 5.2, 8.4, 9.7, 10.3, 11.6),
    # solar_radiation_prop
    c(),
    # snow_diff
    c(-27, -20, -13, -6, -5, -4, -4, -3, -1, 0, 2, 10, 40, 70, 100)
  ),
  data = date_data,
  method = "REML",
  family = binomial(link = "logit"))

date_Viz <- getViz(date_model)

# Knoten extrahieren
# date_model$smooth[[n_smooth]]$knots
# cat(quantile(date_data_noNA$int_date, seq(0,1, 0.1)), sep=", ")
# knots_1 (19)
# c(17877, 178884, 17891, 17898, 17915, 17922, 17929, 17936, 17943, 17950, 17957, 17964, 17971, 17978, 17985, 17992, 17999, 18006, 18014)
# knots_2 (19)
# c(17879, 178886, 17893, 17900, 17917, 17924, 17931, 17938, 17945, 17952, 17959, 17966, 17973, 17980, 17987, 17994, 18001, 18008, 18016)
# knots_3 (24)
# c(17880, 17885, 178890, 17895, 17900, 17915, 17920, 17925, 17930, 17935, 17940, 17945, 17950, 17955, 17960, 17965, 17970, 17975, 17980, 17985, 17990, 17995, 1800, 1805)
# knots_4 (14)
# c(17870, 17880, 17890, 17900, 17919, 17929, 17939, 17949, 17959, 17969, 17979, 17989, 17999, 18009, 18019)
# knots_5 (16)
# c(17876, 17884, 17892, 17900, 17918, 17926, 17934, 17942, 17950, 17958, 17966, 17974, 17982, 17990, 17998, 18006, 18014)
# knots_6 (18)
# c(17876, 178885, 17892, 17900, 17917, 17925, 17932, 17940, 17947, 17955, 17962, 17970, 17977, 17985, 17992, 18000, 18007, 18015)
# knots_7 (18)
# c(17878, 178887, 17894, 17902, 17919, 17927, 17934, 17942, 17949, 17957, 17964, 17972, 17979, 17987, 17994, 18002, 18009, 18017)
# knots_8 (18)
# c(17874, 178883, 17890, 17898, 17915, 17923, 17930, 17938, 17945, 17953, 17960, 17968, 17975, 17983, 17990, 17998, 18005, 18013)
# knots_9 (25)
# c(17880, 17885, 17890, 17895, 17900, 17914, 17919, 17924, 17929, 17934, 17939, 17944, 17949, 17954, 17959, 17964, 17969, 17974, 17979, 17984, 17989, 17994, 17999, 18004, 18009)
# knots_10 (18)
# c(17875, 17882.5, 17890, 17897.5, 17914, 17921.5, 17929, 17936.5, 17944, 17951.5, 17959, 17966.5, 17974, 17981.5, 17989, 17996.5, 18004, 18011.5)




## Werte zurückgeben Funktion

date_model_list <- list(
  
  model = date_model,
  
  summary = summary.gam(date_model,
                        dispersion = date_model$deviance/date_model$df.residual),
  # use plogis() to convert to a probability
  
  Viz = date_Viz
)

return(date_model_list)
}
